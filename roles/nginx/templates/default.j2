log_format main_post '$remote_addr - $remote_user [$time_local] '
					'"$request" $status $bytes_sent [$request_body] '
					'"$http_referer" "$http_user_agent" '
					'"$gzip_ratio" $upstream_response_time';

server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;

    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name {{nginx_domain}};

    # Self signed certs generated by the ssl-cert package
    # Don't use them in a production server!
    #
    # include snippets/snakeoil.conf;

    # TODO certbot
    # ssl on;
    # ssl_certificate /etc/ssl/certs/backbone.ca-bundle.crt;
    # ssl_certificate_key /etc/ssl/private/backbone.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;
    ssl_session_tickets off;

    proxy_connect_timeout       120s;
    proxy_send_timeout          120s;
    proxy_read_timeout          120s;

    root /var/www/html;

    location / {
        # First attempt to serve request as file, then
        # as directory, then fall back to displaying a 404.
        try_files $uri $uri/ =404;
    }
}
